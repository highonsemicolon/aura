load_module modules/ngx_http_auth_jwt_module.so;

events {
    worker_connections 1024;
}

http {
    server {
        listen 80;

        # auth_jwt_key "https://dev-2ib7eu83o3n48mvf.us.auth0.com/.well-known/jwks.json";
        auth_jwt_key "2d2d2d2d2d424547494e205055424c4943204b45592d2d2d2d2d0a4d494942496a414e42676b71686b6947397730424151454641414f43415138414d49494243674b434151454132555568426639474d33726d35326a6d3474686c0a77376135335243547938384d4d687767496273306f69487339377339546d714245686f743573677a55316650374e2b69636b754949476f4b5a4e424e6a4e6c330a693665616b2f796f6c55426c2b6a76716f33656d5465694d2f47337849464d7a657a6e62726a6c47416a3643685a6c532f7343367761513350306f3566786c720a697a45384863495141632b31524e7549316b4d5930765a704e337a6275452b684a356654384b6e316c66757644713233447154542b43456c617739486f7431350a6730414d322f4c782b356e7052714332486343587a3061397055624e386941656e74637a426531372f7756585a6a353474395350484d50786a374e594b556d470a71325a4b55616349696e72416f57357074795365686562596c49454249496d4e4770555a336e4e5a38755850784256775a332f766545474a7861616c62352f4b0a4d514944415141420a2d2d2d2d2d454e44205055424c4943204b45592d2d2d2d2d0a";
        
        auth_jwt_enabled on;

        location /api {
            auth_jwt_validate_sub on;
            auth_jwt_extract_request_claims sub sid pid;
            
            proxy_set_header X-User-Id $http_jwt_sub;
            proxy_set_header Authorization "";
            proxy_pass http://aura:8080;
        }
    }
}
